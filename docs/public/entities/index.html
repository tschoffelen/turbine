<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Entities - Turbine</title>
  <meta name="description" content="Type-safe entity mapping and query library for DynamoDB">
  <link rel="stylesheet" href="https://tschoffelen.github.io/turbine/style.css">
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">
      <a href="https://tschoffelen.github.io/turbine" class="logo">Turbine</a>
      <p class="tagline">DynamoDB made simple</p>
    </div>
    <ul class="nav-links">
      <li><a href="https://tschoffelen.github.io/turbine/quick-start">Quick Start</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/tables">Tables</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/entities">Entities</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/crud">CRUD Operations</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/querying">Querying</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/typescript">TypeScript</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/key-patterns">Key Patterns</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/errors">Error Handling</a></li>
    </ul>
    <div class="sidebar-footer">
      <a href="https://github.com/tschoffelen/turbine" target="_blank">GitHub</a>
      <a href="https://www.npmjs.com/package/dynamodb-turbine" target="_blank">npm</a>
    </div>
  </nav>
  <main class="content">
    
<article>
  <h1>Entities</h1>
  <p>Entities are the core building block of Turbine. They define your data model with a Zod schema and specify how keys are generated.</p>
<h2 id="basic-usage">Basic Usage</h2>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">defineEntity </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;dynamodb-turbine&quot;</span><span>;
</span><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">z </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;zod&quot;</span><span>;
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>    name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">user</span><span>.id],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>,
</span><span>  },
</span><span>});
</span></code></pre>
<h2 id="entity-definition">Entity Definition</h2>
<p>The <code>defineEntity</code> function accepts:</p>
<table><thead><tr><th>Property</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody>
<tr><td><code>table</code></td><td><code>Table</code></td><td>Yes</td><td>The table from <code>defineTable</code></td></tr>
<tr><td><code>schema</code></td><td><code>z.ZodObject</code></td><td>Yes</td><td>A Zod object schema</td></tr>
<tr><td><code>keys</code></td><td><code>object</code></td><td>Yes</td><td>Key generation functions</td></tr>
</tbody></table>
<h2 id="schema-definition">Schema Definition</h2>
<p>Use any Zod object schema to define your entity structure:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Required fields
</span><span>  id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Optional fields
</span><span>  name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">optional</span><span>(),
</span><span>  age: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">number</span><span>().</span><span style="color:#61afef;">optional</span><span>(),
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Fields with defaults
</span><span>  role: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">enum</span><span>([</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;admin&quot;</span><span>]).</span><span style="color:#61afef;">default</span><span>(</span><span style="color:#98c379;">&quot;user&quot;</span><span>),
</span><span>  createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>()),
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Complex types
</span><span>  tags: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">array</span><span>(</span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>()).</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>[]),
</span><span>  metadata: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">record</span><span>(</span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(), </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">unknown</span><span>()).</span><span style="color:#61afef;">optional</span><span>(),
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Nested objects
</span><span>  address: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    street: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    city: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    country: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }).</span><span style="color:#61afef;">optional</span><span>(),
</span><span>})
</span></code></pre>
<h3 id="supported-zod-types">Supported Zod Types</h3>
<p>Turbine supports all Zod types that can be serialized to JSON:</p>
<ul>
<li><code>z.string()</code>, <code>z.number()</code>, <code>z.boolean()</code></li>
<li><code>z.array()</code>, <code>z.object()</code>, <code>z.record()</code></li>
<li><code>z.enum()</code>, <code>z.union()</code>, <code>z.literal()</code></li>
<li><code>z.optional()</code>, <code>z.nullable()</code></li>
<li><code>z.default()</code>, <code>z.transform()</code></li>
<li>Validation methods like <code>.email()</code>, <code>.uuid()</code>, <code>.min()</code>, <code>.max()</code></li>
</ul>
<h2 id="key-definitions">Key Definitions</h2>
<p>Keys determine how items are stored and retrieved in DynamoDB. Each key can be:</p>
<h3 id="static-values">Static Values</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>keys: {
</span><span>  type: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>}
</span></code></pre>
<h3 id="field-references">Field References</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>keys: {
</span><span>  pk: (</span><span style="color:#e06c75;">entity</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">entity</span><span>.id,
</span><span>  sk: (</span><span style="color:#e06c75;">entity</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">entity</span><span>.</span><span style="color:#e06c75;">email</span><span>,
</span><span>}
</span></code></pre>
<h3 id="composite-keys-arrays">Composite Keys (Arrays)</h3>
<p>Arrays are automatically joined with <code>#</code>:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>keys: {
</span><span>  pk: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">user</span><span>.id],     </span><span style="font-style:italic;color:#5c6370;">// becomes &quot;user#&lt;id&gt;&quot;
</span><span>  sk: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;profile&quot;</span><span>, </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>], </span><span style="font-style:italic;color:#5c6370;">// becomes &quot;profile#&lt;email&gt;&quot;
</span><span>}
</span></code></pre>
<h3 id="computed-values">Computed Values</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>keys: {
</span><span>  createdAt: (</span><span style="color:#e06c75;">entity</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">entity</span><span>.</span><span style="color:#e06c75;">createdAt </span><span>|| new Date().</span><span style="color:#61afef;">toISOString</span><span>(),
</span><span>  updatedAt: () </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>(),
</span><span>}
</span></code></pre>
<h3 id="example-full-key-definition">Example: Full Key Definition</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    content: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>()),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Primary key
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">post</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">post</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">post</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">post</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">post</span><span>.id],
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI for querying all posts by date
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1sk</span><span>: (</span><span style="color:#e06c75;">post</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#e06c75;">post</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">post</span><span>.id],
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI for fetching post by ID
</span><span>    </span><span style="color:#61afef;">gsi2pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post#id&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi2sk</span><span>: (</span><span style="color:#e06c75;">post</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">post</span><span>.id,
</span><span>  },
</span><span>});
</span></code></pre>
<h2 id="entity-methods">Entity Methods</h2>
<p>The returned entity object provides these methods:</p>
<h3 id="put-data">put(data)</h3>
<p>Create a new item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>({
</span><span>  id: </span><span style="color:#98c379;">&quot;123&quot;</span><span>,
</span><span>  email: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>  name: </span><span style="color:#98c379;">&quot;Alice&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="get-key">get(key)</h3>
<p>Fetch a single item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#56b6c2;">get</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>],
</span><span>  sk: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="update-key-patch">update(key, patch)</h3>
<p>Update an existing item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">updated </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">update</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>], sk: </span><span style="color:#98c379;">&quot;alice@example.com&quot; </span><span>},
</span><span>  { name: </span><span style="color:#98c379;">&quot;Alice Smith&quot; </span><span>}
</span><span>);
</span></code></pre>
<h3 id="delete-key">delete(key)</h3>
<p>Remove an item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#56b6c2;">delete</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>],
</span><span>  sk: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="query-key-options">query(key, options?)</h3>
<p>Query with pagination:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">results </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>] },
</span><span>  { Limit: </span><span style="color:#d19a66;">10 </span><span>}
</span><span>);
</span></code></pre>
<h3 id="queryone-key-options">queryOne(key, options?)</h3>
<p>Get the first matching item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi2&quot;</span><span>,
</span><span>  gsi2pk: </span><span style="color:#98c379;">&quot;user#email&quot;</span><span>,
</span><span>  gsi2sk: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="queryall-key-options">queryAll(key, options?)</h3>
<p>Get all matching items (handles pagination):</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">allPosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>],
</span><span>});
</span></code></pre>
<h2 id="entity-properties">Entity Properties</h2>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({ </span><span style="font-style:italic;color:#5c6370;">/* ... */ </span><span>});
</span><span>
</span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#e06c75;">definition  </span><span style="font-style:italic;color:#5c6370;">// The original entity definition
</span></code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/crud">CRUD Operations</a> - Detailed guide to create, read, update, delete</li>
<li><a href="/querying">Querying</a> - Advanced query patterns</li>
<li><a href="/typescript">TypeScript</a> - Type inference and Instance types</li>
</ul>

</article>

  </main>
</body>
</html>
