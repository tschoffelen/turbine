<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Key Patterns - Turbine</title>
  <meta name="description" content="Type-safe entity mapping and query library for DynamoDB">
  <link rel="stylesheet" href="https://tschoffelen.github.io/turbine/style.css">
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">
      <a href="https://tschoffelen.github.io/turbine" class="logo">Turbine</a>
      <p class="tagline">DynamoDB made simple</p>
    </div>
    <ul class="nav-links">
      <li><a href="https://tschoffelen.github.io/turbine/quick-start">Quick Start</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/tables">Tables</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/entities">Entities</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/crud">CRUD Operations</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/querying">Querying</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/typescript">TypeScript</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/key-patterns">Key Patterns</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/errors">Error Handling</a></li>
    </ul>
    <div class="sidebar-footer">
      <a href="https://github.com/tschoffelen/turbine" target="_blank">GitHub</a>
      <a href="https://www.npmjs.com/package/dynamodb-turbine" target="_blank">npm</a>
    </div>
  </nav>
  <main class="content">
    
<article>
  <h1>Key Patterns</h1>
  <p>Effective key design is crucial for DynamoDB performance. Turbine makes it easy to implement common patterns.</p>
<h2 id="how-keys-work">How Keys Work</h2>
<p>In Turbine, keys are defined as functions that transform your entity data into DynamoDB attributes:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>keys: {
</span><span>  pk: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">user</span><span>.id],     </span><span style="font-style:italic;color:#5c6370;">// &quot;user#123&quot;
</span><span>  sk: (</span><span style="color:#e06c75;">user</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;profile&quot;</span><span>, </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>], </span><span style="font-style:italic;color:#5c6370;">// &quot;profile#alice@example.com&quot;
</span><span>}
</span></code></pre>
<h3 id="array-joining">Array Joining</h3>
<p>Arrays are automatically joined with <code>#</code>:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>]           </span><span style="font-style:italic;color:#5c6370;">// becomes &quot;user#123&quot;
</span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#98c379;">&quot;2024-01-15&quot;</span><span>, </span><span style="color:#98c379;">&quot;abc&quot;</span><span>] </span><span style="font-style:italic;color:#5c6370;">// becomes &quot;post#2024-01-15#abc&quot;
</span></code></pre>
<h3 id="key-types">Key Types</h3>
<table><thead><tr><th>Type</th><th>Example</th><th>Result</th></tr></thead><tbody>
<tr><td>String</td><td><code>"user"</code></td><td><code>"user"</code></td></tr>
<tr><td>Number</td><td><code>123</code></td><td><code>123</code></td></tr>
<tr><td>Array</td><td><code>["user", id]</code></td><td><code>"user#&lt;id&gt;"</code></td></tr>
<tr><td>Function</td><td><code>() =&gt; "static"</code></td><td><code>"static"</code></td></tr>
</tbody></table>
<h2 id="single-table-design">Single-Table Design</h2>
<p>Single-table design stores multiple entity types in one table, using key prefixes to differentiate them.</p>
<h3 id="entity-type-prefix">Entity Type Prefix</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">u</span><span>.id],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;profile&quot;</span><span>,
</span><span>  },
</span><span>});
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>  },
</span><span>});
</span></code></pre>
<h3 id="query-by-entity-type">Query by Entity Type</h3>
<p>Use a GSI with <code>type</code> as the hash key:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Get all users
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">allUsers </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  type: </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Get all posts
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">allPosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  type: </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>});
</span></code></pre>
<h2 id="common-access-patterns">Common Access Patterns</h2>
<h3 id="one-to-many-relationships">One-to-Many Relationships</h3>
<p>Store related items under the same partition key:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// User owns posts
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Get all posts by user, sorted by date
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">userPosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">userId</span><span>],
</span><span>  sk: { beginsWith: </span><span style="color:#98c379;">&quot;post#&quot; </span><span>},
</span><span>});
</span></code></pre>
<h3 id="lookup-by-id">Lookup by ID</h3>
<p>Create a GSI for direct ID lookups:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI for ID lookup
</span><span>    </span><span style="color:#61afef;">gsi1pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post#id&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">p</span><span>.id,
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Fetch by ID (when you don&#39;t know the author)
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">post </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  gsi1pk: </span><span style="color:#98c379;">&quot;post#id&quot;</span><span>,
</span><span>  gsi1sk: </span><span style="color:#e06c75;">postId</span><span>,
</span><span>});
</span></code></pre>
<h3 id="unique-constraints">Unique Constraints</h3>
<p>Use a GSI to enforce uniqueness:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>    username: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">u</span><span>.id],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;profile&quot;</span><span>,
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI for email lookup (unique)
</span><span>    </span><span style="color:#61afef;">gsi1pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;user#email&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1sk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">u</span><span>.</span><span style="color:#e06c75;">email</span><span>,
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI for username lookup (unique)
</span><span>    </span><span style="color:#61afef;">gsi2pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;user#username&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi2sk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">u</span><span>.</span><span style="color:#e06c75;">username</span><span>,
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Check if email exists
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">existing </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  gsi1pk: </span><span style="color:#98c379;">&quot;user#email&quot;</span><span>,
</span><span>  gsi1sk: </span><span style="color:#e06c75;">email</span><span>,
</span><span>});
</span></code></pre>
<h3 id="timeline-feed">Timeline / Feed</h3>
<p>Sort items by timestamp:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Global feed GSI
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post#feed&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// User&#39;s posts (newest first)
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">userPosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">userId</span><span>], sk: { beginsWith: </span><span style="color:#98c379;">&quot;post#&quot; </span><span>} },
</span><span>  { ScanIndexForward: </span><span style="color:#d19a66;">false</span><span>, Limit: </span><span style="color:#d19a66;">20 </span><span>}
</span><span>);
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Global feed (newest first)
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">feed </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>, gsi1pk: </span><span style="color:#98c379;">&quot;post#feed&quot; </span><span>},
</span><span>  { ScanIndexForward: </span><span style="color:#d19a66;">false</span><span>, Limit: </span><span style="color:#d19a66;">20 </span><span>}
</span><span>);
</span></code></pre>
<h3 id="hierarchical-data">Hierarchical Data</h3>
<p>Model hierarchies with composite keys:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Organization &gt; Team &gt; Member
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">members </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    orgId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    teamId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    userId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    role: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">m</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;org&quot;</span><span>, </span><span style="color:#e06c75;">m</span><span>.</span><span style="color:#e06c75;">orgId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">m</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;team&quot;</span><span>, </span><span style="color:#e06c75;">m</span><span>.</span><span style="color:#e06c75;">teamId</span><span>, </span><span style="color:#98c379;">&quot;member&quot;</span><span>, </span><span style="color:#e06c75;">m</span><span>.</span><span style="color:#e06c75;">userId</span><span>],
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// All members in an org
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">members</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;org&quot;</span><span>, </span><span style="color:#e06c75;">orgId</span><span>],
</span><span>  sk: { beginsWith: </span><span style="color:#98c379;">&quot;team#&quot; </span><span>},
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// All members in a specific team
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">members</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;org&quot;</span><span>, </span><span style="color:#e06c75;">orgId</span><span>],
</span><span>  sk: { beginsWith: [</span><span style="color:#98c379;">&quot;team&quot;</span><span>, </span><span style="color:#e06c75;">teamId</span><span>, </span><span style="color:#98c379;">&quot;member&quot;</span><span>] },
</span><span>});
</span></code></pre>
<h2 id="key-design-tips">Key Design Tips</h2>
<h3 id="use-consistent-prefixes">Use Consistent Prefixes</h3>
<p>Prefix partition keys with entity type for clarity:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Good: Clear prefixes
</span><span>pk: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">u</span><span>.id]
</span><span>pk: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.id]
</span><span>pk: (</span><span style="color:#e06c75;">o</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;order&quot;</span><span>, </span><span style="color:#e06c75;">o</span><span>.id]
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Avoid: Ambiguous keys
</span><span>pk: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">u</span><span>.id
</span></code></pre>
<h3 id="include-timestamp-for-sorting">Include Timestamp for Sorting</h3>
<p>When you need chronological ordering, include timestamps in sort keys:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Good: Sortable by time
</span><span>sk: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id]
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// The ID at the end ensures uniqueness if timestamps collide
</span></code></pre>
<h3 id="use-iso-timestamps">Use ISO Timestamps</h3>
<p>ISO format strings sort correctly as strings:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>())
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Results: &quot;2024-01-15T10:30:00.000Z&quot; sorts before &quot;2024-02-01T08:00:00.000Z&quot;
</span></code></pre>
<h3 id="plan-your-gsis">Plan Your GSIs</h3>
<p>Design GSIs based on your access patterns:</p>
<table><thead><tr><th>Access Pattern</th><th>GSI Design</th></tr></thead><tbody>
<tr><td>Get all entities of a type</td><td><code>hashKey: type</code></td></tr>
<tr><td>Lookup by unique field</td><td><code>hashKey: "entity#field", rangeKey: value</code></td></tr>
<tr><td>Timeline/feed</td><td><code>hashKey: "entity#feed", rangeKey: timestamp</code></td></tr>
<tr><td>Filter by status</td><td><code>hashKey: status, rangeKey: timestamp</code></td></tr>
</tbody></table>
<h2 id="example-complete-entity-design">Example: Complete Entity Design</h2>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">posts </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">uuid</span><span>(),
</span><span>    authorId: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    title: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    content: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    status: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">enum</span><span>([</span><span style="color:#98c379;">&quot;draft&quot;</span><span>, </span><span style="color:#98c379;">&quot;published&quot;</span><span>, </span><span style="color:#98c379;">&quot;archived&quot;</span><span>]),
</span><span>    createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>()),
</span><span>    updatedAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">optional</span><span>(),
</span><span>  }),
</span><span>  keys: {
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Primary: User&#39;s posts sorted by date
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">authorId</span><span>],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI1: All posts by type
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI2: Global feed
</span><span>    </span><span style="color:#61afef;">gsi1pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post#feed&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi1sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI3: Lookup by ID
</span><span>    </span><span style="color:#61afef;">gsi2pk</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;post#id&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">gsi2sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span style="color:#e06c75;">p</span><span>.id,
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// GSI4: Posts by status
</span><span>    </span><span style="color:#61afef;">gsi3pk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;post#status&quot;</span><span>, </span><span style="color:#e06c75;">p</span><span>.status],
</span><span>    </span><span style="color:#61afef;">gsi3sk</span><span>: (</span><span style="color:#e06c75;">p</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#e06c75;">p</span><span>.</span><span style="color:#e06c75;">createdAt</span><span>, </span><span style="color:#e06c75;">p</span><span>.id],
</span><span>  },
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Access patterns enabled:
</span><span style="font-style:italic;color:#5c6370;">// 1. Get user&#39;s posts: query pk=user#&lt;id&gt;
</span><span style="font-style:italic;color:#5c6370;">// 2. Get all posts: query gsi1 type=post
</span><span style="font-style:italic;color:#5c6370;">// 3. Global feed: query gsi2 gsi1pk=post#feed
</span><span style="font-style:italic;color:#5c6370;">// 4. Lookup by ID: query gsi3 gsi2pk=post#id, gsi2sk=&lt;id&gt;
</span><span style="font-style:italic;color:#5c6370;">// 5. Posts by status: query gsi4 gsi3pk=post#status#published
</span></code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/querying">Querying</a> - Use your keys effectively</li>
<li><a href="/errors">Error Handling</a> - Handle key-related errors</li>
</ul>

</article>

  </main>
</body>
</html>
