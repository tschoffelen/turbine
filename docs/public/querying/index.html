<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Querying - Turbine</title>
  <meta name="description" content="Type-safe entity mapping and query library for DynamoDB">
  <link rel="stylesheet" href="https://tschoffelen.github.io/turbine/style.css">
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">
      <a href="https://tschoffelen.github.io/turbine" class="logo">Turbine</a>
      <p class="tagline">DynamoDB made simple</p>
    </div>
    <ul class="nav-links">
      <li><a href="https://tschoffelen.github.io/turbine/quick-start">Quick Start</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/tables">Tables</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/entities">Entities</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/crud">CRUD Operations</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/querying">Querying</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/typescript">TypeScript</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/key-patterns">Key Patterns</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/errors">Error Handling</a></li>
    </ul>
    <div class="sidebar-footer">
      <a href="https://github.com/tschoffelen/turbine" target="_blank">GitHub</a>
      <a href="https://www.npmjs.com/package/dynamodb-turbine" target="_blank">npm</a>
    </div>
  </nav>
  <main class="content">
    
<article>
  <h1>Querying</h1>
  <p>Turbine provides powerful query methods for retrieving multiple items from DynamoDB.</p>
<h2 id="query-methods">Query Methods</h2>
<h3 id="query">query()</h3>
<p>Returns paginated results:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">results </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">query</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>],
</span><span>});
</span><span>
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">results</span><span>);        </span><span style="font-style:italic;color:#5c6370;">// Array of Instance objects
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">results</span><span>.length); </span><span style="font-style:italic;color:#5c6370;">// Number of items in this page
</span></code></pre>
<h3 id="queryone">queryOne()</h3>
<p>Returns the first matching item:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;byEmail&quot;</span><span>,
</span><span>  email: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>});
</span><span>
</span><span style="color:#c678dd;">if </span><span>(</span><span style="color:#e06c75;">user</span><span>) {
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.name);
</span><span>}
</span></code></pre>
<h3 id="queryall">queryAll()</h3>
<p>Fetches all pages automatically:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">allUsers </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  type: </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Returns all matching items, handling pagination internally
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">allUsers</span><span>.length);
</span></code></pre>
<h2 id="key-conditions">Key Conditions</h2>
<h3 id="hash-key-required">Hash Key (Required)</h3>
<p>Every query must specify a hash key with an equality condition:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Simple value
</span><span>{ pk: </span><span style="color:#98c379;">&quot;user#123&quot; </span><span>}
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Array (joined with #)
</span><span>{ pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>] }
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Explicit equals
</span><span>{ pk: { equals: </span><span style="color:#98c379;">&quot;user#123&quot; </span><span>} }
</span></code></pre>
<h3 id="range-key-optional">Range Key (Optional)</h3>
<p>Range keys support various operators:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Equality
</span><span>{ sk: </span><span style="color:#98c379;">&quot;profile&quot; </span><span>}
</span><span>{ sk: { equals: </span><span style="color:#98c379;">&quot;profile&quot; </span><span>} }
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Prefix matching
</span><span>{ sk: { beginsWith: </span><span style="color:#98c379;">&quot;post#2024&quot; </span><span>} }
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Comparisons
</span><span>{ sk: { greaterThan: </span><span style="color:#d19a66;">100 </span><span>} }
</span><span>{ sk: { lessThan: </span><span style="color:#d19a66;">200 </span><span>} }
</span><span>{ sk: { greaterThanOrEquals: </span><span style="color:#d19a66;">100 </span><span>} }
</span><span>{ sk: { lessThanOrEquals: </span><span style="color:#d19a66;">200 </span><span>} }
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Range
</span><span>{ sk: { between: [</span><span style="color:#98c379;">&quot;2024-01-01&quot;</span><span>, </span><span style="color:#98c379;">&quot;2024-12-31&quot;</span><span>] } }
</span></code></pre>
<h2 id="index-selection">Index Selection</h2>
<p>Use the <code>index</code> property to query a GSI:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Query the primary table index (default)
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>({
</span><span>  pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>],
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Query a GSI
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  gsi1pk: </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>  gsi1sk: { beginsWith: </span><span style="color:#98c379;">&quot;2024-01&quot; </span><span>},
</span><span>});
</span></code></pre>
<blockquote>
<p>The index name must match one defined in your <code>defineTable</code> call.</p>
</blockquote>
<h2 id="filter-expressions">Filter Expressions</h2>
<p>Filters narrow results after the key conditions are applied:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">activePosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>] },
</span><span>  {
</span><span>    filters: {
</span><span>      status: </span><span style="color:#98c379;">&quot;published&quot;</span><span>,
</span><span>      deletedAt: { notExists: </span><span style="color:#d19a66;">true </span><span>},
</span><span>    },
</span><span>  }
</span><span>);
</span></code></pre>
<h3 id="filter-operators">Filter Operators</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span>filters: {
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Equality
</span><span>  status: </span><span style="color:#98c379;">&quot;active&quot;</span><span>,
</span><span>  status: { equals: </span><span style="color:#98c379;">&quot;active&quot; </span><span>},
</span><span>  status: { notEquals: </span><span style="color:#98c379;">&quot;deleted&quot; </span><span>},
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Comparisons
</span><span>  count: { greaterThan: </span><span style="color:#d19a66;">10 </span><span>},
</span><span>  count: { lessThan: </span><span style="color:#d19a66;">100 </span><span>},
</span><span>  count: { greaterThanOrEquals: </span><span style="color:#d19a66;">10 </span><span>},
</span><span>  count: { lessThanOrEquals: </span><span style="color:#d19a66;">100 </span><span>},
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Range
</span><span>  count: { between: [</span><span style="color:#d19a66;">10</span><span>, </span><span style="color:#d19a66;">100</span><span>] },
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// String operations
</span><span>  title: { beginsWith: </span><span style="color:#98c379;">&quot;Hello&quot; </span><span>},
</span><span>  title: { contains: </span><span style="color:#98c379;">&quot;world&quot; </span><span>},
</span><span>  title: { notContains: </span><span style="color:#98c379;">&quot;spam&quot; </span><span>},
</span><span>
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Existence checks
</span><span>  deletedAt: { exists: </span><span style="color:#d19a66;">true </span><span>},
</span><span>  deletedAt: { notExists: </span><span style="color:#d19a66;">true </span><span>},
</span><span>}
</span></code></pre>
<h2 id="pagination">Pagination</h2>
<h3 id="manual-pagination">Manual Pagination</h3>
<p>Use <code>query()</code> for manual control:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// First page
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">page1 </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { type: </span><span style="color:#98c379;">&quot;user&quot; </span><span>},
</span><span>  { Limit: </span><span style="color:#d19a66;">10 </span><span>}
</span><span>);
</span><span>
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">page1</span><span>.length);           </span><span style="font-style:italic;color:#5c6370;">// Up to 10 items
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">page1</span><span>.</span><span style="color:#e06c75;">lastEvaluatedKey</span><span>); </span><span style="font-style:italic;color:#5c6370;">// Cursor for next page
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Next page using the convenience function
</span><span style="color:#c678dd;">if </span><span>(</span><span style="color:#e06c75;">page1</span><span>.next) {
</span><span>  </span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">page2 </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">page1</span><span>.</span><span style="color:#61afef;">next</span><span>();
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Or manually with ExclusiveStartKey
</span><span style="color:#c678dd;">if </span><span>(</span><span style="color:#e06c75;">page1</span><span>.</span><span style="color:#e06c75;">lastEvaluatedKey</span><span>) {
</span><span>  </span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">page2 </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>    { type: </span><span style="color:#98c379;">&quot;user&quot; </span><span>},
</span><span>    { Limit: </span><span style="color:#d19a66;">10</span><span>, ExclusiveStartKey: </span><span style="color:#e06c75;">page1</span><span>.</span><span style="color:#e06c75;">lastEvaluatedKey </span><span>}
</span><span>  );
</span><span>}
</span></code></pre>
<h3 id="automatic-pagination">Automatic Pagination</h3>
<p>Use <code>queryAll()</code> to fetch everything:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">allUsers </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  type: </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Handles all pagination internally
</span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">allUsers</span><span>.length);
</span></code></pre>
<blockquote>
<p>Be careful with <code>queryAll()</code> on large datasets as it fetches everything.</p>
</blockquote>
<h2 id="query-options">Query Options</h2>
<p>Pass DynamoDB query options as the second argument:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">results </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>] },
</span><span>  {
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Pagination
</span><span>    Limit: </span><span style="color:#d19a66;">20</span><span>,
</span><span>    ExclusiveStartKey: </span><span style="color:#e06c75;">lastKey</span><span>,
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Sort order (false = descending)
</span><span>    ScanIndexForward: </span><span style="color:#d19a66;">false</span><span>,
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Consistency
</span><span>    ConsistentRead: </span><span style="color:#d19a66;">true</span><span>,
</span><span>
</span><span>    </span><span style="font-style:italic;color:#5c6370;">// Filters
</span><span>    filters: {
</span><span>      status: </span><span style="color:#98c379;">&quot;published&quot;</span><span>,
</span><span>    },
</span><span>  }
</span><span>);
</span></code></pre>
<h3 id="common-options">Common Options</h3>
<table><thead><tr><th>Option</th><th>Type</th><th>Description</th></tr></thead><tbody>
<tr><td><code>Limit</code></td><td><code>number</code></td><td>Maximum items to return</td></tr>
<tr><td><code>ExclusiveStartKey</code></td><td><code>object</code></td><td>Start position for pagination</td></tr>
<tr><td><code>ScanIndexForward</code></td><td><code>boolean</code></td><td><code>true</code> = ascending, <code>false</code> = descending</td></tr>
<tr><td><code>ConsistentRead</code></td><td><code>boolean</code></td><td>Use strongly consistent reads</td></tr>
<tr><td><code>filters</code></td><td><code>object</code></td><td>Filter expressions</td></tr>
</tbody></table>
<h2 id="examples">Examples</h2>
<h3 id="get-latest-posts">Get Latest Posts</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">latestPosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>  {
</span><span>    index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>    gsi1pk: </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    gsi1sk: { beginsWith: </span><span style="color:#98c379;">&quot;2024&quot; </span><span>},
</span><span>  },
</span><span>  {
</span><span>    Limit: </span><span style="color:#d19a66;">10</span><span>,
</span><span>    ScanIndexForward: </span><span style="color:#d19a66;">false</span><span>, </span><span style="font-style:italic;color:#5c6370;">// Newest first
</span><span>  }
</span><span>);
</span></code></pre>
<h3 id="find-user-by-email">Find User by Email</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;byEmail&quot;</span><span>,
</span><span>  email: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="get-all-user-s-active-posts">Get All User's Active Posts</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">activePosts </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryAll</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">userId</span><span>] },
</span><span>  {
</span><span>    filters: {
</span><span>      status: </span><span style="color:#98c379;">&quot;published&quot;</span><span>,
</span><span>      deletedAt: { notExists: </span><span style="color:#d19a66;">true </span><span>},
</span><span>    },
</span><span>  }
</span><span>);
</span></code></pre>
<h3 id="paginated-feed">Paginated Feed</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">async function </span><span style="color:#61afef;">getFeed</span><span>(</span><span style="color:#e06c75;">cursor</span><span>?: Record&lt;string, unknown&gt;) {
</span><span>  </span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">page </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">query</span><span>(
</span><span>    {
</span><span>      index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>      gsi1pk: </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>    },
</span><span>    {
</span><span>      Limit: </span><span style="color:#d19a66;">20</span><span>,
</span><span>      ScanIndexForward: </span><span style="color:#d19a66;">false</span><span>,
</span><span>      ExclusiveStartKey: </span><span style="color:#e06c75;">cursor</span><span>,
</span><span>      filters: {
</span><span>        status: </span><span style="color:#98c379;">&quot;published&quot;</span><span>,
</span><span>      },
</span><span>    }
</span><span>  );
</span><span>
</span><span>  </span><span style="color:#c678dd;">return </span><span>{
</span><span>    items: </span><span style="color:#e06c75;">page</span><span>,
</span><span>    nextCursor: </span><span style="color:#e06c75;">page</span><span>.</span><span style="color:#e06c75;">lastEvaluatedKey</span><span>,
</span><span>    hasMore: !!</span><span style="color:#e06c75;">page</span><span>.next,
</span><span>  };
</span><span>}
</span></code></pre>
<h3 id="date-range-query">Date Range Query</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">postsInJanuary </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">posts</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>  index: </span><span style="color:#98c379;">&quot;gsi1&quot;</span><span>,
</span><span>  gsi1pk: </span><span style="color:#98c379;">&quot;post&quot;</span><span>,
</span><span>  gsi1sk: { between: [</span><span style="color:#98c379;">&quot;2024-01-01&quot;</span><span>, </span><span style="color:#98c379;">&quot;2024-01-31&quot;</span><span>] },
</span><span>});
</span></code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/key-patterns">Key Patterns</a> - Design effective key structures</li>
<li><a href="/typescript">TypeScript</a> - Type safety with queries</li>
</ul>

</article>

  </main>
</body>
</html>
