<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TypeScript - Turbine</title>
  <meta name="description" content="Type-safe entity mapping and query library for DynamoDB">
  <link rel="stylesheet" href="https://tschoffelen.github.io/turbine/style.css">
</head>
<body>
  <nav class="sidebar">
    <div class="sidebar-header">
      <a href="https://tschoffelen.github.io/turbine" class="logo">Turbine</a>
      <p class="tagline">DynamoDB made simple</p>
    </div>
    <ul class="nav-links">
      <li><a href="https://tschoffelen.github.io/turbine/quick-start">Quick Start</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/tables">Tables</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/entities">Entities</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/crud">CRUD Operations</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/querying">Querying</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/typescript">TypeScript</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/key-patterns">Key Patterns</a></li>
      <li><a href="https://tschoffelen.github.io/turbine/errors">Error Handling</a></li>
    </ul>
    <div class="sidebar-footer">
      <a href="https://github.com/tschoffelen/turbine" target="_blank">GitHub</a>
      <a href="https://www.npmjs.com/package/dynamodb-turbine" target="_blank">npm</a>
    </div>
  </nav>
  <main class="content">
    
<article>
  <h1>TypeScript</h1>
  <p>Turbine is built with TypeScript and provides full type safety throughout your application.</p>
<h2 id="instance-type">Instance Type</h2>
<p>The <code>Instance</code> type represents the result of entity operations. Use it to type variables and function parameters:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">import type </span><span>{ </span><span style="color:#e06c75;">Instance </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;dynamodb-turbine&quot;</span><span>;
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Get the Instance type from your entity
</span><span style="color:#c678dd;">type </span><span>User = Instance&lt;typeof users&gt;;
</span><span>
</span><span style="color:#c678dd;">function </span><span style="color:#61afef;">displayUser</span><span>(</span><span style="color:#e06c75;">user</span><span>: User) {
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.id);
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>);
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.name);
</span><span>}
</span></code></pre>
<h3 id="what-instance-includes">What Instance Includes</h3>
<p>An Instance contains:</p>
<ol>
<li><strong>All schema fields</strong> - Every field from your Zod schema</li>
<li><strong>Generated key values</strong> - The actual key values stored in DynamoDB</li>
<li><strong>update() method</strong> - Convenience method for updates</li>
</ol>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>({
</span><span>  id: </span><span style="color:#98c379;">&quot;123&quot;</span><span>,
</span><span>  email: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>  name: </span><span style="color:#98c379;">&quot;Alice&quot;</span><span>,
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Schema fields
</span><span style="color:#e06c75;">user</span><span>.id;    </span><span style="font-style:italic;color:#5c6370;">// string
</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>; </span><span style="font-style:italic;color:#5c6370;">// string
</span><span style="color:#e06c75;">user</span><span>.name;  </span><span style="font-style:italic;color:#5c6370;">// string
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Key values (also present as attributes)
</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">pk</span><span>;    </span><span style="font-style:italic;color:#5c6370;">// &quot;user#123&quot;
</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">sk</span><span>;    </span><span style="font-style:italic;color:#5c6370;">// &quot;alice@example.com&quot;
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Instance method
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#61afef;">update</span><span>({ name: </span><span style="color:#98c379;">&quot;Alice Smith&quot; </span><span>});
</span></code></pre>
<h2 id="type-inference-from-entities">Type Inference from Entities</h2>
<p>TypeScript automatically infers types from your entity definitions:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>    id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>    email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>    name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">optional</span><span>(),
</span><span>    role: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">enum</span><span>([</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;admin&quot;</span><span>]),
</span><span>    createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>(),
</span><span>  }),
</span><span>  keys: { </span><span style="font-style:italic;color:#5c6370;">/* ... */ </span><span>},
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// TypeScript knows the exact shape
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>({
</span><span>  id: </span><span style="color:#98c379;">&quot;123&quot;</span><span>,
</span><span>  email: </span><span style="color:#98c379;">&quot;alice@example.com&quot;</span><span>,
</span><span>  role: </span><span style="color:#98c379;">&quot;admin&quot;</span><span>, </span><span style="font-style:italic;color:#5c6370;">// Must be &quot;user&quot; | &quot;admin&quot;
</span><span>  createdAt: new Date().</span><span style="color:#61afef;">toISOString</span><span>(),
</span><span>});
</span><span>
</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">role</span><span>;  </span><span style="font-style:italic;color:#5c6370;">// Type: &quot;user&quot; | &quot;admin&quot;
</span><span style="color:#e06c75;">user</span><span>.name;  </span><span style="font-style:italic;color:#5c6370;">// Type: string | undefined
</span></code></pre>
<h2 id="type-safe-operations">Type-Safe Operations</h2>
<h3 id="put">put()</h3>
<p>The input type is inferred from your schema, respecting optional fields and defaults:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Schema with defaults
</span><span>schema: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>  id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  role: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">enum</span><span>([</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;admin&quot;</span><span>]).</span><span style="color:#61afef;">default</span><span>(</span><span style="color:#98c379;">&quot;user&quot;</span><span>),
</span><span>  createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>()),
</span><span>})
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Only required fields needed
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>({
</span><span>  id: </span><span style="color:#98c379;">&quot;123&quot;</span><span>,
</span><span>  name: </span><span style="color:#98c379;">&quot;Alice&quot;</span><span>,
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// role and createdAt have defaults, so they&#39;re optional
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// TypeScript error: missing &#39;name&#39;
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>({
</span><span>  id: </span><span style="color:#98c379;">&quot;123&quot;</span><span>,
</span><span>});
</span></code></pre>
<h3 id="get-and-query">get() and query()</h3>
<p>Return types are automatically <code>Instance | null</code> or <code>Instance[]</code>:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">const </span><span style="color:#e06c75;">user </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#56b6c2;">get</span><span>({ </span><span style="font-style:italic;color:#5c6370;">/* ... */ </span><span>});
</span><span style="font-style:italic;color:#5c6370;">// Type: Instance&lt;typeof users&gt; | null
</span><span>
</span><span style="color:#c678dd;">if </span><span>(</span><span style="color:#e06c75;">user</span><span>) {
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// TypeScript knows user is not null here
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.name);
</span><span>}
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">results </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({ </span><span style="font-style:italic;color:#5c6370;">/* ... */ </span><span>});
</span><span style="font-style:italic;color:#5c6370;">// Type: Instance&lt;typeof users&gt;[]
</span><span>
</span><span style="color:#e06c75;">results</span><span>.</span><span style="color:#56b6c2;">forEach</span><span>(</span><span style="color:#e06c75;">user </span><span style="color:#c678dd;">=&gt; </span><span>{
</span><span>  </span><span style="color:#e5c07b;">console</span><span>.</span><span style="color:#56b6c2;">log</span><span>(</span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#e06c75;">email</span><span>); </span><span style="font-style:italic;color:#5c6370;">// TypeScript knows the shape
</span><span>});
</span></code></pre>
<h3 id="update">update()</h3>
<p>The patch type is a partial of your schema:</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// Entity update - accepts Partial&lt;Schema&gt;
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">update</span><span>(
</span><span>  { pk: [</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;123&quot;</span><span>], sk: </span><span style="color:#98c379;">&quot;alice@example.com&quot; </span><span>},
</span><span>  { name: </span><span style="color:#98c379;">&quot;Alice Smith&quot; </span><span>} </span><span style="font-style:italic;color:#5c6370;">// Partial&lt;Schema&gt;
</span><span>);
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Instance update - same partial type
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#61afef;">update</span><span>({
</span><span>  role: </span><span style="color:#98c379;">&quot;admin&quot;</span><span>, </span><span style="font-style:italic;color:#5c6370;">// Type-checked against schema
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// TypeScript error: &#39;unknown&#39; is not in schema
</span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">user</span><span>.</span><span style="color:#61afef;">update</span><span>({
</span><span>  unknown: </span><span style="color:#98c379;">&quot;field&quot;</span><span>,
</span><span>});
</span></code></pre>
<h2 id="using-instance-in-functions">Using Instance in Functions</h2>
<h3 id="function-parameters">Function Parameters</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">type </span><span>User = Instance&lt;typeof users&gt;;
</span><span style="color:#c678dd;">type </span><span>Post = Instance&lt;typeof posts&gt;;
</span><span>
</span><span style="color:#c678dd;">function </span><span style="color:#61afef;">formatUser</span><span>(</span><span style="color:#e06c75;">user</span><span>: User): string {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#98c379;">`${</span><span style="color:#e06c75;">user</span><span style="color:#98c379;">.name} (${</span><span style="color:#e06c75;">user</span><span style="color:#98c379;">.</span><span style="color:#e06c75;">email</span><span style="color:#98c379;">})`</span><span>;
</span><span>}
</span><span>
</span><span style="color:#c678dd;">async function </span><span style="color:#61afef;">publishPost</span><span>(</span><span style="color:#e06c75;">post</span><span>: Post): Promise&lt;Post&gt; {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">post</span><span>.</span><span style="color:#61afef;">update</span><span>({ status: </span><span style="color:#98c379;">&quot;published&quot; </span><span>});
</span><span>}
</span></code></pre>
<h3 id="return-types">Return Types</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">type </span><span>User = Instance&lt;typeof users&gt;;
</span><span>
</span><span style="color:#c678dd;">async function </span><span style="color:#61afef;">getActiveUsers</span><span>(): Promise&lt;User[]&gt; {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryAll</span><span>({
</span><span>    type: </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>  }, {
</span><span>    filters: {
</span><span>      status: </span><span style="color:#98c379;">&quot;active&quot;</span><span>,
</span><span>    },
</span><span>  });
</span><span>}
</span><span>
</span><span style="color:#c678dd;">async function </span><span style="color:#61afef;">findUserByEmail</span><span>(</span><span style="color:#e06c75;">email</span><span>: string): Promise&lt;User | null&gt; {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">queryOne</span><span>({
</span><span>    index: </span><span style="color:#98c379;">&quot;byEmail&quot;</span><span>,
</span><span>    </span><span style="color:#e06c75;">email</span><span>,
</span><span>  });
</span><span>}
</span></code></pre>
<h3 id="generic-functions">Generic Functions</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">import type </span><span>{ </span><span style="color:#e06c75;">Entity</span><span>, </span><span style="color:#e06c75;">Instance </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;dynamodb-turbine&quot;</span><span>;
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Generic function that works with any entity
</span><span style="color:#c678dd;">async function </span><span style="color:#61afef;">countItems</span><span>&lt;E </span><span style="color:#c678dd;">extends </span><span>Entity&lt;any&gt;&gt;(
</span><span>  </span><span style="color:#e06c75;">entity</span><span>: E,
</span><span>  </span><span style="color:#e06c75;">key</span><span>: Parameters&lt;E[</span><span style="color:#98c379;">&quot;queryAll&quot;</span><span>]&gt;[</span><span style="color:#d19a66;">0</span><span>]
</span><span>): Promise&lt;number&gt; {
</span><span>  </span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">items </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#e06c75;">entity</span><span>.</span><span style="color:#61afef;">queryAll</span><span>(</span><span style="color:#e06c75;">key</span><span>);
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">items</span><span>.length;
</span><span>}
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">userCount </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#61afef;">countItems</span><span>(</span><span style="color:#e06c75;">users</span><span>, { type: </span><span style="color:#98c379;">&quot;user&quot; </span><span>});
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">postCount </span><span>= </span><span style="color:#c678dd;">await </span><span style="color:#61afef;">countItems</span><span>(</span><span style="color:#e06c75;">posts</span><span>, { type: </span><span style="color:#98c379;">&quot;post&quot; </span><span>});
</span></code></pre>
<h2 id="extracting-schema-types">Extracting Schema Types</h2>
<p>You can extract the raw schema type (without Instance methods):</p>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">z </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;zod&quot;</span><span>;
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">userSchema </span><span>= </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>  id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>  name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Raw schema type (for validation, forms, etc.)
</span><span style="color:#c678dd;">type </span><span>UserData = z.infer&lt;typeof userSchema&gt;;
</span><span>
</span><span style="color:#c678dd;">const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">userSchema</span><span>,
</span><span>  keys: { </span><span style="font-style:italic;color:#5c6370;">/* ... */ </span><span>},
</span><span>});
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Instance type (includes update method)
</span><span style="color:#c678dd;">type </span><span>User = Instance&lt;typeof users&gt;;
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// UserData for input validation
</span><span style="color:#c678dd;">function </span><span style="color:#61afef;">validateUserInput</span><span>(</span><span style="color:#e06c75;">data</span><span>: unknown): UserData {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">userSchema</span><span>.</span><span style="color:#56b6c2;">parse</span><span>(</span><span style="color:#e06c75;">data</span><span>);
</span><span>}
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// User for database operations
</span><span style="color:#c678dd;">async function </span><span style="color:#61afef;">createUser</span><span>(</span><span style="color:#e06c75;">data</span><span>: UserData): Promise&lt;User&gt; {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>(</span><span style="color:#e06c75;">data</span><span>);
</span><span>}
</span></code></pre>
<h2 id="common-patterns">Common Patterns</h2>
<h3 id="separating-entity-and-types">Separating Entity and Types</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// entities/user.ts
</span><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">defineEntity </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;dynamodb-turbine&quot;</span><span>;
</span><span style="color:#c678dd;">import type </span><span>{ </span><span style="color:#e06c75;">Instance </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;dynamodb-turbine&quot;</span><span>;
</span><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">z </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;zod&quot;</span><span>;
</span><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">table </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;./table&quot;</span><span>;
</span><span>
</span><span style="color:#c678dd;">export const </span><span style="color:#e06c75;">userSchema </span><span>= </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">object</span><span>({
</span><span>  id: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  email: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">email</span><span>(),
</span><span>  name: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>(),
</span><span>  role: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">enum</span><span>([</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#98c379;">&quot;admin&quot;</span><span>]).</span><span style="color:#61afef;">default</span><span>(</span><span style="color:#98c379;">&quot;user&quot;</span><span>),
</span><span>  createdAt: </span><span style="color:#e06c75;">z</span><span>.</span><span style="color:#61afef;">string</span><span>().</span><span style="color:#61afef;">datetime</span><span>().</span><span style="color:#61afef;">default</span><span>(() </span><span style="color:#c678dd;">=&gt; </span><span>new Date().</span><span style="color:#61afef;">toISOString</span><span>()),
</span><span>});
</span><span>
</span><span style="color:#c678dd;">export const </span><span style="color:#e06c75;">users </span><span>= </span><span style="color:#61afef;">defineEntity</span><span>({
</span><span>  </span><span style="color:#e06c75;">table</span><span>,
</span><span>  schema: </span><span style="color:#e06c75;">userSchema</span><span>,
</span><span>  keys: {
</span><span>    </span><span style="color:#61afef;">type</span><span>: () </span><span style="color:#c678dd;">=&gt; </span><span style="color:#98c379;">&quot;user&quot;</span><span>,
</span><span>    </span><span style="color:#61afef;">pk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;user&quot;</span><span>, </span><span style="color:#e06c75;">u</span><span>.id],
</span><span>    </span><span style="color:#61afef;">sk</span><span>: (</span><span style="color:#e06c75;">u</span><span>) </span><span style="color:#c678dd;">=&gt; </span><span>[</span><span style="color:#98c379;">&quot;profile&quot;</span><span>, </span><span style="color:#e06c75;">u</span><span>.</span><span style="color:#e06c75;">email</span><span>],
</span><span>  },
</span><span>});
</span><span>
</span><span style="color:#c678dd;">export type </span><span>User = Instance&lt;typeof users&gt;;
</span><span style="color:#c678dd;">export type </span><span>UserInput = z.input&lt;typeof userSchema&gt;;
</span></code></pre>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="font-style:italic;color:#5c6370;">// services/user-service.ts
</span><span style="color:#c678dd;">import </span><span>{ </span><span style="color:#e06c75;">users</span><span>, </span><span style="color:#e06c75;">type User</span><span>, </span><span style="color:#e06c75;">type UserInput </span><span>} </span><span style="color:#c678dd;">from </span><span style="color:#98c379;">&quot;../entities/user&quot;</span><span>;
</span><span>
</span><span style="color:#c678dd;">export async function </span><span style="color:#61afef;">createUser</span><span>(</span><span style="color:#e06c75;">input</span><span>: UserInput): Promise&lt;User&gt; {
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">users</span><span>.</span><span style="color:#61afef;">put</span><span>(</span><span style="color:#e06c75;">input</span><span>);
</span><span>}
</span><span>
</span><span style="color:#c678dd;">export async function </span><span style="color:#61afef;">getUserById</span><span>(</span><span style="color:#e06c75;">id</span><span>: string): Promise&lt;User | null&gt; {
</span><span>  </span><span style="font-style:italic;color:#5c6370;">// Implementation
</span><span>}
</span></code></pre>
<h3 id="api-response-types">API Response Types</h3>
<pre data-lang="typescript" style="background-color:#282c34;color:#abb2bf;" class="language-typescript "><code class="language-typescript" data-lang="typescript"><span style="color:#c678dd;">type </span><span>User = Instance&lt;typeof users&gt;;
</span><span>
</span><span style="font-style:italic;color:#5c6370;">// Omit internal fields for API responses
</span><span style="color:#c678dd;">type </span><span>UserResponse = Omit&lt;User, </span><span style="color:#98c379;">&quot;pk&quot; </span><span>| </span><span style="color:#98c379;">&quot;sk&quot; </span><span>| </span><span style="color:#98c379;">&quot;update&quot;</span><span>&gt;;
</span><span>
</span><span style="color:#c678dd;">function </span><span style="color:#61afef;">toResponse</span><span>(</span><span style="color:#e06c75;">user</span><span>: User): UserResponse {
</span><span>  </span><span style="color:#c678dd;">const </span><span>{ </span><span style="color:#e06c75;">pk</span><span>, </span><span style="color:#e06c75;">sk</span><span>, </span><span style="color:#e06c75;">update</span><span>, ...</span><span style="color:#e06c75;">rest </span><span>} = </span><span style="color:#e06c75;">user</span><span>;
</span><span>  </span><span style="color:#c678dd;">return </span><span style="color:#e06c75;">rest</span><span>;
</span><span>}
</span></code></pre>
<h2 id="next-steps">Next Steps</h2>
<ul>
<li><a href="/key-patterns">Key Patterns</a> - Design effective key structures</li>
<li><a href="/errors">Error Handling</a> - Handle Turbine errors</li>
</ul>

</article>

  </main>
</body>
</html>
